<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Downloading Illumina Sequence Data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="site_libs/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}

.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    Background
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="background_bash.html">Using bash</a>
    </li>
    <li>
      <a href="sftp.html">Using sftp</a>
    </li>
    <li>
      <a href="resources.html">Additional Coding Resources</a>
    </li>
  </ul>
</li>
<li>
  <a href="downloading_illumina.html">
    <span class="fa fa-database fa-1x"></span>
     
    Downloading Data
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="ion ion-ios-barcode-outline"></span>
     
    Alignment
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="de_novo_assembly.html">de Novo Assembly</a>
    </li>
    <li>
      <a href="reference.html">Reference Assembly</a>
    </li>
    <li>
      <a href="merging.html">Merging Reads</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Filtering/QC
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="subsampling.html">Subsampling</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    PopGen Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="popgen_tools.html">Tools</a>
    </li>
    <li>
      <a href="pca.html">PCA</a>
    </li>
    <li>
      <a href="admixture.html">Admixture</a>
    </li>
    <li>
      <a href="FST.html">F_st</a>
    </li>
    <li>
      <a href="ngsCovar.html">ngsRelate</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Piplelines
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pipeline_colony.html">Colony</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Post-Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="upload_ncbi.html">Uploading to NCBI</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">Contact</a>
</li>
<li>
  <a href="https://github.com/ryanpeek/radseq">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Downloading Illumina Sequence Data</h1>

</div>


<div id="general-genomic-information" class="section level2">
<h2>General Genomic Information</h2>
<p>You’ll need to know which cutter you are using, so you can pull/use the appropriate barcode and splitting scripts. Basically, each sample/file will end up labeled with a Biotin <strong>Plate</strong> barcode, and an individual <strong>Well</strong> barcode.</p>
<p>These will look something like (for <em>Sbf1</em>):</p>
<ul>
<li><em>PlateBarcode</em>-CC_CCTGCA_GG_<em>FRAGMENT</em></li>
</ul>
<div id="cutters" class="section level3">
<h3>Cutters</h3>
<p>The two cutters we primarily use are:</p>
<ul>
<li>Six cutter <code>(5' -  CTGCA_G - 3')</code> <em>Pst1</em></li>
<li>Eight cutter <code>(5' - CCTGCA_GG - 3')</code> <em>Sbf1</em></li>
</ul>
<div id="q-phred-quality-scores" class="section level4">
<h4>Q Phred Quality scores</h4>
<p>Initial files are <code>.fastq</code> because they contain Q quality scores.</p>
<ul>
<li>there are 4 lines per each individuals sequence</li>
<li>score is series of characters-&gt;numbers-&gt;CAPletters-&gt;lowercaseletters lowest-&gt;highest</li>
<li>Q represents the quality score of nucleotides generated by automated DNA seq
<ul>
<li><code>Q = -10log10 P</code> where P = base calling error probability</li>
<li>50 would be 99.999%; 20 would be 99%; 10 would be 90%</li>
<li>Most common is <code>+33</code></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="downloadsymlink" class="section level2">
<h2>Download/Symlink</h2>
<p><em>All sequencing files come as zipped .fastq files</em></p>
<ol style="list-style-type: decimal">
<li><p>Make a new directory inside your project folder: <code>mkdir SOMMXXX</code></p></li>
<li>Files are always downloaded here: <code>~millermr/UCDavis/SOMM_/*index_*</code>
<ul>
<li>to learn plate barcode, open info.txt in SOMM folder <code>SOMM____ INDEX___</code></li>
<li>you can either copy the files over using <code>cp ~millermr/UCDavis/SOMM_/* ./</code></li>
<li>OR, you can make a symbolic link, e.g., : <code>ln -s /home/millermr/UCDavis/SOMM163/*.gz /home/your_project/raw</code> (<em>it does require full path</em>)</li>
</ul></li>
<li>To unzip files, use <code>sbatch</code> and <code>gunzip -c</code> and re-direct the output to a file of the same name (minus <code>.gz</code>):
<ul>
<li><code>sbatch -t 8:00:00 -p high gunzip -c SOMM163_S1_L001_R1_001.fastq.gz &gt; SOMM163_S1_L001_R1_001.fastq</code></li>
</ul></li>
<li><p>Once completed, move the unzipped files into your “split” folder. If you <code>cp</code> the entire <code>fastq.gz</code> files, you can remove them.</p></li>
</ol>
<div id="split-by-plate" class="section level3">
<h3>Split by Plate</h3>
<ol style="list-style-type: decimal">
<li>This takes the R2 reads, which is the plate codes, and matches to the different reads. Once done, we can delete the R2 reads and use the R1/R3 reads for the Split by Well Barcodes. This requires the following scripts:
<ul>
<li><code>run_split.sh</code></li>
<li><code>BarcodeSplitList3Files.pl</code></li>
</ul></li>
</ol>
<div id="run_split.sh" class="section level4">
<h4><code>run_split.sh</code></h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="va">r1=$1</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="va">r2=$2</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="va">r3=$3</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="va">out=$4</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="fu">perl</span> BarcodeSplitList3Files.pl <span class="va">$r1</span> <span class="va">$r2</span> <span class="va">$r3</span> CCGTTT,AACGTT,TCAGTT,CGTCTT,TAGCTT,GATATT,CTCATT,TCTTGT,CGCTGT,GTATGT,CATGGT,GGGGGT,AAGAGT,GCCAGT,ATGGCT,TGCGCT,GACCCT,ACACCT,CCTACT,TTAACT,TACTAT,TTTGAT,GTGCAT,CAACAT,CGGAAT,TTTTTG,CGATTG,GAGGTG,TGCCTG,AGTATG,AAATGG,ACCGGG,TTAGGG,CCTCGG,ATGCGG,GTTAGG,GCCTCG,TCTGCG,CACGCG,GGACCG,TAGACG,ATCACG,CTGTAG,GGCGAG,TCGCAG,AACCAG,CATAAG,GCAAAG,CATTTC,TGGTTC,GTCGTC,AGAGTC,TCTCTC,ACGATC,ATCTGC,CCATGC,TACGGC,GGTCGC,CAGCGC,TTGAGC,AAGTCC,CTTGCC,GCGCCC,CGCCCC,TGTACC,CAAACC,ACTTAC,GGATAC,GATGAC,AGGCAC,TTACAC,TCCAAC,AGCTTA,GAATTA,TGTGTA,CCCGTA,ATACTA,GTGATA,CTTTGA,GCAGGA,AATCGA,TGGCGA,GTCCGA,CCGAGA,AGAAGA,GGTTCA,TTGTCA,CGGGCA,TAAGCA,TCCCCA,TCATAA,ACGGAA,CTAGAA,GCTCAA,ATTAAA,GACAAA,CGATGT,TTAGGC,TGACCA,ACAGTG,GCCAAT,CAGATC,ACTTGA,GATCAG,GGCTAC,CTTGTA,AGTCAA,AGTTCC,ATGTCA,CCGTCC,GTCCGC,GTGAAA,GTGGCC,GTTTCG,CGTACG,GAGTGG,ACTGAT,ATTCCT <span class="va">$out</span></a></code></pre></div>
</div>
<div id="barcodesplitlist3files.pl" class="section level4">
<h4><code>BarcodeSplitList3Files.pl</code></h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#!/usr/bin/perl</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">if</span> <span class="kw">(</span><span class="va">$#</span><span class="ex">ARGV</span> == 4<span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">        <span class="va">$fileR1</span> = <span class="va">$ARGV[0]</span>;</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">        <span class="va">$fileR2</span> = <span class="va">$ARGV[1]</span>;</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">        <span class="va">$fileR3</span> = <span class="va">$ARGV[2]</span>;</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">        <span class="va">$barcode</span> = <span class="va">$ARGV[3]</span>;</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">        <span class="va">$prefix</span> = <span class="va">$ARGV[4]</span>;</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">        <span class="ex">die</span><span class="kw">;</span>    </a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw">}</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="ex">@commas</span> = split(/\,/, <span class="va">$barcode</span>);</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="va">$x</span>=<span class="ex">0</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="kw">while</span> <span class="kw">(</span><span class="va">$x</span> <span class="op">&lt;</span>= <span class="va">$#</span><span class="ex">commas</span><span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">        <span class="va">$hashR1</span><span class="dt">{$commas[$x]}</span> = <span class="va">$prefix</span> <span class="bu">.</span> <span class="st">&quot;_R1_&quot;</span> <span class="bu">.</span> <span class="va">$commas[$x]</span> <span class="bu">.</span> <span class="st">&quot;.fastq&quot;</span>;</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">        <span class="va">$filenameR1</span> = <span class="va">$hashR1</span><span class="dt">{$commas[$x]}</span>;</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">        <span class="ex">open</span>(<span class="va">$filenameR1</span>, <span class="st">&quot;&gt;</span><span class="va">$filenameR1</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">        <span class="va">$hashR2</span><span class="dt">{$commas[$x]}</span> = <span class="va">$prefix</span> <span class="bu">.</span> <span class="st">&quot;_R2_&quot;</span> <span class="bu">.</span> <span class="va">$commas[$x]</span> <span class="bu">.</span> <span class="st">&quot;.fastq&quot;</span>;</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">        <span class="va">$filenameR2</span> = <span class="va">$hashR2</span><span class="dt">{$commas[$x]}</span>;</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">        <span class="ex">open</span>(<span class="va">$filenameR2</span>, <span class="st">&quot;&gt;</span><span class="va">$filenameR2</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">        <span class="va">$hashR3</span><span class="dt">{$commas[$x]}</span> = <span class="va">$prefix</span> <span class="bu">.</span> <span class="st">&quot;_R3_&quot;</span> <span class="bu">.</span> <span class="va">$commas[$x]</span> <span class="bu">.</span> <span class="st">&quot;.fastq&quot;</span>;</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">        <span class="va">$filenameR3</span> = <span class="va">$hashR3</span><span class="dt">{$commas[$x]}</span>;</a>
<a class="sourceLine" id="cb2-28" data-line-number="28">        <span class="ex">open</span>(<span class="va">$filenameR3</span>, <span class="st">&quot;&gt;</span><span class="va">$filenameR3</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"></a>
<a class="sourceLine" id="cb2-30" data-line-number="30">        <span class="va">$x</span><span class="ex">++</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="kw">}</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="ex">open</span>(FILER1, <span class="st">&quot;&lt;</span><span class="va">$fileR1</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="ex">open</span>(FILER2, <span class="st">&quot;&lt;</span><span class="va">$fileR2</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="ex">open</span>(FILER3, <span class="st">&quot;&lt;</span><span class="va">$fileR3</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="kw">while</span> <span class="kw">(</span><span class="op">&lt;</span><span class="ex">FILER1</span><span class="op">&gt;</span><span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"></a>
<a class="sourceLine" id="cb2-41" data-line-number="41">        <span class="va">$R1_l1</span> = <span class="va">$_</span>;</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">        <span class="va">$R1_l2</span> = <span class="op">&lt;</span><span class="ex">FILER1</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43">        <span class="va">$R1_l3</span> = <span class="op">&lt;</span><span class="ex">FILER1</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44">        <span class="va">$R1_l4</span> = <span class="op">&lt;</span><span class="ex">FILER1</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45">        </a>
<a class="sourceLine" id="cb2-46" data-line-number="46">        <span class="va">$R2_l1</span> = <span class="op">&lt;</span><span class="ex">FILER2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47">        <span class="va">$R2_l2</span> = <span class="op">&lt;</span><span class="ex">FILER2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48">        <span class="va">$R2_l3</span> = <span class="op">&lt;</span><span class="ex">FILER2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49">        <span class="va">$R2_l4</span> = <span class="op">&lt;</span><span class="ex">FILER2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-50" data-line-number="50"></a>
<a class="sourceLine" id="cb2-51" data-line-number="51">        <span class="va">$R3_l1</span> = <span class="op">&lt;</span><span class="ex">FILER3</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52">        <span class="va">$R3_l2</span> = <span class="op">&lt;</span><span class="ex">FILER3</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-53" data-line-number="53">        <span class="va">$R3_l3</span> = <span class="op">&lt;</span><span class="ex">FILER3</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-54" data-line-number="54">        <span class="va">$R3_l4</span> = <span class="op">&lt;</span><span class="ex">FILER3</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-55" data-line-number="55"></a>
<a class="sourceLine" id="cb2-56" data-line-number="56">        <span class="va">$bc</span> = <span class="ex">substr</span>(<span class="va">$R2_l2</span>,0,6);</a>
<a class="sourceLine" id="cb2-57" data-line-number="57">        </a>
<a class="sourceLine" id="cb2-58" data-line-number="58">        <span class="kw">if</span> <span class="kw">(</span><span class="va">$hashR1</span><span class="dt">{$bc}</span> <span class="ex">ne</span> <span class="st">&quot;&quot;</span><span class="kw">)</span>  <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-59" data-line-number="59">        </a>
<a class="sourceLine" id="cb2-60" data-line-number="60">                <span class="va">$F1</span> = <span class="va">$hashR1</span><span class="dt">{$bc}</span>; <span class="va">$F2</span> = <span class="va">$hashR2</span><span class="dt">{$bc}</span>; <span class="va">$F3</span> = <span class="va">$hashR3</span><span class="dt">{$bc}</span>;</a>
<a class="sourceLine" id="cb2-61" data-line-number="61">                <span class="ex">print</span> <span class="va">$F1</span> <span class="va">$R1_l1</span> . <span class="va">$R1_l2</span> . <span class="va">$R1_l3</span> . <span class="va">$R1_l4</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-62" data-line-number="62">                <span class="ex">print</span> <span class="va">$F2</span> <span class="va">$R2_l1</span> . <span class="va">$R2_l2</span> . <span class="va">$R2_l3</span> . <span class="va">$R2_l4</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-63" data-line-number="63">                <span class="ex">print</span> <span class="va">$F3</span> <span class="va">$R3_l1</span> . <span class="va">$R3_l2</span> . <span class="va">$R3_l3</span> . <span class="va">$R3_l4</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-64" data-line-number="64"></a>
<a class="sourceLine" id="cb2-65" data-line-number="65">        <span class="kw">}</span></a>
<a class="sourceLine" id="cb2-66" data-line-number="66"></a>
<a class="sourceLine" id="cb2-67" data-line-number="67"><span class="kw">}</span></a>
<a class="sourceLine" id="cb2-68" data-line-number="68"><span class="ex">close</span> FILER1<span class="kw">;</span> <span class="ex">close</span> FILER2<span class="kw">;</span> <span class="ex">close</span> FILER3<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-69" data-line-number="69"></a>
<a class="sourceLine" id="cb2-70" data-line-number="70"><span class="va">$x</span>=<span class="ex">0</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-71" data-line-number="71"><span class="kw">while</span> <span class="kw">(</span><span class="va">$x</span> <span class="op">&lt;</span>= <span class="va">$#</span><span class="ex">commas</span><span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-72" data-line-number="72">        <span class="va">$F1</span> = <span class="va">$hashR1</span><span class="dt">{$commas[$x]}</span>; <span class="va">$F2</span> = <span class="va">$hashR2</span><span class="dt">{$commas[$x]}</span>; <span class="va">$F3</span> = <span class="va">$hashR3</span><span class="dt">{$commas[$x]}</span>;</a>
<a class="sourceLine" id="cb2-73" data-line-number="73">        <span class="ex">close</span>(<span class="va">$F1</span>); <span class="ex">close</span>(<span class="va">$F2</span>); <span class="ex">close</span>(<span class="va">$F3</span>);</a>
<a class="sourceLine" id="cb2-74" data-line-number="74">        <span class="va">$x</span><span class="ex">++</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-75" data-line-number="75"><span class="kw">}</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Run script using something like:
<ul>
<li><code>sbatch -t 8:00:00 run_split.sh SOMM163_S1_L001_R1_001.fastq SOMM163_S1_L001_R2_001.fastq SOMM163_S1_L001_R3_001.fastq SOMM163</code></li>
</ul></li>
<li>If other plates with no data, or not your data, need to sort/filter. One option is to sort by size <code>du -hs *fastq | sort -hs</code>, get just the plates that have data…<em>(should see a size jump between plates w data and those without)</em>.
<ul>
<li>This lists all files of interest, but may need to pipe to head or tail to filter:</li>
</ul></li>
</ol>
<ul>
<li><code>du -hs *fastq | sort -hs | cut -f2</code></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Move them to a folder of interest, here, the <code>split_out</code> folder in the <code>split</code> folder.</li>
</ol>
<ul>
<li><code>du -hs *fastq | sort -hs | tail -n37 | head -n-3 | cut -f2 | sed &quot;s/^/mv /g&quot; | sed &quot;s/$/ split_out\//g&quot;</code></li>
</ul>
</div>
</div>
<div id="split-by-well-barcodes" class="section level3">
<h3>Split by Well Barcodes</h3>
<ol style="list-style-type: decimal">
<li>Now we have each plate barcode, but we need to split samples by well. This requires the following scripts:
<ul>
<li><code>BarcodeSplitListBestRadPairedEnd.pl</code></li>
<li><code>run_wellsplit.sh</code> (<em>make sure executable: <code>chmod u+x script</code></em>)</li>
<li><code>run_BestRadSplit.sh</code> (check you have correct version (6 or 8) depending on enzyme used)</li>
</ul></li>
</ol>
<div id="barcodesplitlistbestradpairedend.pl" class="section level4">
<h4><code>BarcodeSplitListBestRadPairedEnd.pl</code></h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#!/usr/bin/perl</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">if</span> <span class="kw">(</span><span class="va">$#</span><span class="ex">ARGV</span> == 3<span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">        <span class="va">$file1</span> = <span class="va">$ARGV[0]</span>;</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">        <span class="va">$file2</span> = <span class="va">$ARGV[1]</span>;</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">        <span class="va">$barcode</span> = <span class="va">$ARGV[2]</span>;</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">        <span class="va">$prefix</span> = <span class="va">$ARGV[3]</span>;</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">        <span class="ex">die</span><span class="kw">;</span>    </a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="ex">@commas</span> = split(/\,/, <span class="va">$barcode</span>);</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="va">$barcode_length</span> = <span class="ex">length</span>(<span class="va">$commas[0]</span>);</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="va">$x</span>=<span class="ex">0</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="kw">while</span> <span class="kw">(</span><span class="va">$x</span> <span class="op">&lt;</span>= <span class="va">$#</span><span class="ex">commas</span><span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">        <span class="va">$hash_r1</span><span class="dt">{$commas[$x]}</span> = <span class="va">$prefix</span> <span class="bu">.</span> <span class="st">&quot;_RA_&quot;</span> <span class="bu">.</span> <span class="va">$commas[$x]</span> <span class="bu">.</span> <span class="st">&quot;.fastq&quot;</span>;</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">        <span class="va">$hash_r2</span><span class="dt">{$commas[$x]}</span> = <span class="va">$prefix</span> <span class="bu">.</span> <span class="st">&quot;_RB_&quot;</span> <span class="bu">.</span> <span class="va">$commas[$x]</span> <span class="bu">.</span> <span class="st">&quot;.fastq&quot;</span>;</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">        <span class="va">$filename_r1</span> = <span class="va">$hash_r1</span><span class="dt">{$commas[$x]}</span>;</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">        <span class="va">$filename_r2</span> = <span class="va">$hash_r2</span><span class="dt">{$commas[$x]}</span>;</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">        <span class="ex">open</span>(<span class="va">$filename_r1</span>, <span class="st">&quot;&gt;</span><span class="va">$filename_r1</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">        <span class="ex">open</span>(<span class="va">$filename_r2</span>, <span class="st">&quot;&gt;</span><span class="va">$filename_r2</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">        <span class="va">$x</span><span class="ex">++</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="ex">open</span>(FILE1, <span class="st">&quot;&lt;</span><span class="va">$file1</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="ex">open</span>(FILE2, <span class="st">&quot;&lt;</span><span class="va">$file2</span><span class="st">&quot;</span>) <span class="ex">or</span> die<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="kw">while</span> <span class="kw">(</span><span class="op">&lt;</span><span class="ex">FILE1</span><span class="op">&gt;</span><span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"></a>
<a class="sourceLine" id="cb3-33" data-line-number="33">        <span class="va">$f1a</span> = <span class="va">$_</span>;</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">        <span class="va">$f1b</span> = <span class="op">&lt;</span><span class="ex">FILE1</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35">        <span class="va">$f1c</span> = <span class="op">&lt;</span><span class="ex">FILE1</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36">        <span class="va">$f1d</span> = <span class="op">&lt;</span><span class="ex">FILE1</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"></a>
<a class="sourceLine" id="cb3-38" data-line-number="38">        <span class="va">$f2a</span> = <span class="op">&lt;</span><span class="ex">FILE2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-39" data-line-number="39">        <span class="va">$f2b</span> = <span class="op">&lt;</span><span class="ex">FILE2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-40" data-line-number="40">        <span class="va">$f2c</span> = <span class="op">&lt;</span><span class="ex">FILE2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-41" data-line-number="41">        <span class="va">$f2d</span> = <span class="op">&lt;</span><span class="ex">FILE2</span><span class="op">&gt;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-42" data-line-number="42">        </a>
<a class="sourceLine" id="cb3-43" data-line-number="43">        <span class="va">$bc1</span> = <span class="ex">substr</span>(<span class="va">$f1b</span>,0,<span class="va">$barcode_length</span>);</a>
<a class="sourceLine" id="cb3-44" data-line-number="44">        <span class="va">$bc2</span> = <span class="ex">substr</span>(<span class="va">$f2b</span>,0,<span class="va">$barcode_length</span>);</a>
<a class="sourceLine" id="cb3-45" data-line-number="45">        </a>
<a class="sourceLine" id="cb3-46" data-line-number="46">        <span class="kw">if</span> <span class="kw">(</span><span class="va">$hash_r1</span><span class="dt">{$bc1}</span> <span class="ex">ne</span> <span class="st">&quot;&quot;</span> <span class="kw">&amp;&amp;</span> <span class="va">$hash_r1</span><span class="dt">{$bc2}</span> <span class="ex">eq</span> <span class="st">&quot;&quot;</span><span class="kw">)</span>  <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-47" data-line-number="47"></a>
<a class="sourceLine" id="cb3-48" data-line-number="48">                <span class="va">$f1b_2</span> = <span class="ex">substr</span>(<span class="va">$f1b</span>, <span class="va">$barcode_length</span>, length(<span class="va">$f1b</span>));</a>
<a class="sourceLine" id="cb3-49" data-line-number="49">                <span class="va">$f1d_2</span> = <span class="ex">substr</span>(<span class="va">$f1d</span>, <span class="va">$barcode_length</span>, length(<span class="va">$f1d</span>));</a>
<a class="sourceLine" id="cb3-50" data-line-number="50"></a>
<a class="sourceLine" id="cb3-51" data-line-number="51">                <span class="va">$out1</span> = <span class="va">$hash_r1</span><span class="dt">{$bc1}</span>;</a>
<a class="sourceLine" id="cb3-52" data-line-number="52">                <span class="va">$out2</span> = <span class="va">$hash_r2</span><span class="dt">{$bc1}</span>;</a>
<a class="sourceLine" id="cb3-53" data-line-number="53"></a>
<a class="sourceLine" id="cb3-54" data-line-number="54">                <span class="ex">print</span> <span class="va">$out1</span> <span class="va">$f1a</span> . <span class="va">$f1b_2</span> . <span class="va">$f1c</span> . <span class="va">$f1d_2</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-55" data-line-number="55">                <span class="ex">print</span> <span class="va">$out2</span> <span class="va">$f2a</span> . <span class="va">$f2b</span> . <span class="va">$f2c</span> . <span class="va">$f2d</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-56" data-line-number="56">                </a>
<a class="sourceLine" id="cb3-57" data-line-number="57">        <span class="kw">}</span> <span class="ex">elsif</span> (<span class="va">$hash_r1</span><span class="dt">{$bc1}</span> eq <span class="st">&quot;&quot;</span> <span class="kw">&amp;&amp;</span> <span class="va">$hash_r1</span><span class="dt">{$bc2}</span> <span class="ex">ne</span> <span class="st">&quot;&quot;</span>)  <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-58" data-line-number="58"></a>
<a class="sourceLine" id="cb3-59" data-line-number="59">                <span class="va">$f2b_2</span> = <span class="ex">substr</span>(<span class="va">$f2b</span>, <span class="va">$barcode_length</span>, length(<span class="va">$f2b</span>));</a>
<a class="sourceLine" id="cb3-60" data-line-number="60">                <span class="va">$f2d_2</span> = <span class="ex">substr</span>(<span class="va">$f2d</span>, <span class="va">$barcode_length</span>, length(<span class="va">$f2d</span>));</a>
<a class="sourceLine" id="cb3-61" data-line-number="61"></a>
<a class="sourceLine" id="cb3-62" data-line-number="62">                <span class="va">$out1</span> = <span class="va">$hash_r1</span><span class="dt">{$bc2}</span>;</a>
<a class="sourceLine" id="cb3-63" data-line-number="63">                <span class="va">$out2</span> = <span class="va">$hash_r2</span><span class="dt">{$bc2}</span>;</a>
<a class="sourceLine" id="cb3-64" data-line-number="64"></a>
<a class="sourceLine" id="cb3-65" data-line-number="65">                <span class="ex">print</span> <span class="va">$out1</span> <span class="va">$f2a</span> . <span class="va">$f2b_2</span> . <span class="va">$f2c</span> . <span class="va">$f2d_2</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-66" data-line-number="66">                <span class="ex">print</span> <span class="va">$out2</span> <span class="va">$f1a</span> . <span class="va">$f1b</span> . <span class="va">$f1c</span> . <span class="va">$f1d</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-67" data-line-number="67"></a>
<a class="sourceLine" id="cb3-68" data-line-number="68">        <span class="kw">}</span> <span class="ex">elsif</span> (<span class="va">$hash_r1</span><span class="dt">{$bc1}</span> ne <span class="st">&quot;&quot;</span> <span class="kw">&amp;&amp;</span> <span class="va">$hash_r1</span><span class="dt">{$bc2}</span> <span class="ex">ne</span> <span class="st">&quot;&quot;</span>)  <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-69" data-line-number="69"></a>
<a class="sourceLine" id="cb3-70" data-line-number="70">                <span class="ex">print</span> <span class="st">&quot;Double Barcode!\t</span><span class="va">$bc1</span><span class="st">\t</span><span class="va">$bc2</span><span class="st">\n&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-71" data-line-number="71">        </a>
<a class="sourceLine" id="cb3-72" data-line-number="72">        <span class="kw">}</span></a>
<a class="sourceLine" id="cb3-73" data-line-number="73"></a>
<a class="sourceLine" id="cb3-74" data-line-number="74"><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-75" data-line-number="75"><span class="ex">close</span> FILE1<span class="kw">;</span> <span class="ex">close</span> FILE2<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-76" data-line-number="76"></a>
<a class="sourceLine" id="cb3-77" data-line-number="77"></a>
<a class="sourceLine" id="cb3-78" data-line-number="78"></a>
<a class="sourceLine" id="cb3-79" data-line-number="79"><span class="va">$x</span>=<span class="ex">0</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-80" data-line-number="80"><span class="kw">while</span> <span class="kw">(</span><span class="va">$x</span> <span class="op">&lt;</span>= <span class="va">$#</span><span class="ex">commas</span><span class="kw">)</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-81" data-line-number="81">        <span class="ex">close</span>(<span class="va">$hash_r1</span><span class="dt">{$commas[$x]}</span>);</a>
<a class="sourceLine" id="cb3-82" data-line-number="82">        <span class="ex">close</span>(<span class="va">$hash_r2</span><span class="dt">{$commas[$x]}</span>);</a>
<a class="sourceLine" id="cb3-83" data-line-number="83">        <span class="va">$x</span><span class="ex">++</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb3-84" data-line-number="84"><span class="kw">}</span></a></code></pre></div>
</div>
<div id="run_wellsplit.sh" class="section level4">
<h4><code>run_wellsplit.sh</code></h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">#!/bin/bash -l</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="va">list=$1</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="va">wc=$(</span><span class="fu">wc</span> -l <span class="va">${list}</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="va">)</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="va">x=</span>1</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw">while</span><span class="bu"> [</span> <span class="va">$x</span> <span class="ot">-le</span> <span class="va">$wc</span><span class="bu"> ]</span> </a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw">do</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">        <span class="va">string=</span><span class="st">&quot;sed -n </span><span class="va">${x}</span><span class="st">p </span><span class="va">${list}</span><span class="st">&quot;</span> </a>
<a class="sourceLine" id="cb4-11" data-line-number="11">        <span class="va">str=$($string)</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">        <span class="va">var=$(</span><span class="bu">echo</span> <span class="va">$str</span> <span class="kw">|</span> <span class="fu">awk</span> -F<span class="st">&quot;\t&quot;</span> <span class="st">&#39;{print $1, $2, $3}&#39;</span><span class="va">)</span>   </a>
<a class="sourceLine" id="cb4-14" data-line-number="14">        <span class="kw">set</span> <span class="ex">--</span> <span class="va">$var</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">        <span class="va">c1=$1</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">        <span class="va">c2=$2</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">        <span class="va">c3=$3</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">        <span class="fu">sh</span> run_BestRadSplit.sh <span class="va">$c1</span> <span class="va">$c2</span> <span class="va">$c3</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"></a>
<a class="sourceLine" id="cb4-21" data-line-number="21">        <span class="va">x=$((</span> <span class="va">$x</span> + 1 <span class="va">))</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="kw">done</span></a></code></pre></div>
</div>
<div id="run_bestradsplit.sh" class="section level4">
<h4><code>run_BestRadSplit.sh</code></h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="va">f1=$1</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="va">f2=$2</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="va">out=$3</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="fu">perl</span> BarcodeSplitListBestRadPairedEnd.pl <span class="va">$f1</span> <span class="va">$f2</span> GGACAAGCTATGCAGG,GGAAACATCGTGCAGG,GGACATTGGCTGCAGG,GGACCACTGTTGCAGG,GGAACGTGATTGCAGG,GGCGCTGATCTGCAGG,GGCAGATCTGTGCAGG,GGATGCCTAATGCAGG,GGAACGAACGTGCAGG,GGAGTACAAGTGCAGG,GGCATCAAGTTGCAGG,GGAGTGGTCATGCAGG,GGAACAACCATGCAGG,GGAACCGAGATGCAGG,GGAACGCTTATGCAGG,GGAAGACGGATGCAGG,GGAAGGTACATGCAGG,GGACACAGAATGCAGG,GGACAGCAGATGCAGG,GGACCTCCAATGCAGG,GGACGCTCGATGCAGG,GGACGTATCATGCAGG,GGACTATGCATGCAGG,GGAGAGTCAATGCAGG,GGAGATCGCATGCAGG,GGAGCAGGAATGCAGG,GGAGTCACTATGCAGG,GGATCCTGTATGCAGG,GGATTGAGGATGCAGG,GGCAACCACATGCAGG,GGCAAGACTATGCAGG,GGCAATGGAATGCAGG,GGCACTTCGATGCAGG,GGCAGCGTTATGCAGG,GGCATACCAATGCAGG,GGCCAGTTCATGCAGG,GGCCGAAGTATGCAGG,GGCCGTGAGATGCAGG,GGCCTCCTGATGCAGG,GGCGAACTTATGCAGG,GGCGACTGGATGCAGG,GGCGCATACATGCAGG,GGCTCAATGATGCAGG,GGCTGAGCCATGCAGG,GGCTGGCATATGCAGG,GGGAATCTGATGCAGG,GGGACTAGTATGCAGG,GGGAGCTGAATGCAGG,GGGATAGACATGCAGG,GGGCCACATATGCAGG,GGGCGAGTAATGCAGG,GGGCTAACGATGCAGG,GGGCTCGGTATGCAGG,GGGGAGAACATGCAGG,GGGGTGCGAATGCAGG,GGGTACGCAATGCAGG,GGGTCGTAGATGCAGG,GGGTCTGTCATGCAGG,GGGTGTTCTATGCAGG,GGTAGGATGATGCAGG,GGTATCAGCATGCAGG,GGTCCGTCTATGCAGG,GGTCTTCACATGCAGG,GGTGAAGAGATGCAGG,GGTGGAACAATGCAGG,GGTGGCTTCATGCAGG,GGTGGTGGTATGCAGG,GGTTCACGCATGCAGG,GGACACGAGATGCAGG,GGAAGAGATCTGCAGG,GGAAGGACACTGCAGG,GGAATCCGTCTGCAGG,GGAATGTTGCTGCAGG,GGACACTGACTGCAGG,GGACAGATTCTGCAGG,GGAGATGTACTGCAGG,GGAGCACCTCTGCAGG,GGAGCCATGCTGCAGG,GGAGGCTAACTGCAGG,GGATAGCGACTGCAGG,GGACGACAAGTGCAGG,GGATTGGCTCTGCAGG,GGCAAGGAGCTGCAGG,GGCACCTTACTGCAGG,GGCCATCCTCTGCAGG,GGCCGACAACTGCAGG,GGAGTCAAGCTGCAGG,GGCCTCTATCTGCAGG,GGCGACACACTGCAGG,GGCGGATTGCTGCAGG,GGCTAAGGTCTGCAGG,GGGAACAGGCTGCAGG,GGGACAGTGCTGCAGG,GGGAGTTAGCTGCAGG,GGGATGAATCTGCAGG,GGGCCAAGACTGCAGG <span class="va">$out</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Make a list of the files we want to split out (need the R1/R3’s):
<ul>
<li><code>ls *R1*.fastq &gt; listR1</code></li>
<li><code>ls *R3*.fastq &gt; listR3</code></li>
</ul></li>
<li>Then cut and pipe with <code>sed</code> to add the third column (the individual plate codes for the script):
<ul>
<li><code>ls S*R1* | sed &quot;s/_R1//g&quot; | sed &quot;s/\.fastq//g&quot; | paste listR1 listR3 - &gt; flist</code></li>
</ul></li>
<li>Then we can use a <em><code>screen</code></em> to run the script to split out wells.
<ul>
<li><code>srun -t 12:00:00 -p high run_wellsplit.sh flist</code></li>
<li><code>smap -c | grep USERNAME</code></li>
<li>This runs the perl script <code>BarcodeSplitListBestRadPairedEnd.pl</code> and looks at R1 and R2 to find which has the Indiv. barcode (because the probe sits down randomly on either), then puts all the fragments with barcodes as RA and those without as RB. This should give you the same # of lines for RA and RB.</li>
<li>Script bases matches on location in file (as sorted) but a numeric value is available</li>
<li>RA will be slightly smaller (use <code>du -hs</code>) because the barcode is cleaved (but still in the name of the file)</li>
<li>this takes a good 30 minutes or more with lots of samples/plates</li>
<li>cp the files over to the <code>fastq</code> folder in your dir</li>
</ul></li>
</ol>
</div>
</div>
</div>
<div id="add-metadatasitenames-optional" class="section level2">
<h2>Add Metadata/SiteNames (Optional)</h2>
<p>If you want to add metadata to your filenames, you can do that here, but it is optional. A metadata file should contains the name of each individual, its location on the plate, etc. <em><span style="color:red"> This part can be done now or later. But be absolutely sure that your indiv names, their plate location (A1, B1, etc.), and the appropriate barcode are all in sync. For example, the barcodes might be A1 A2 A3 (Across the plate row) while your sample names are A1 B1 C1 (Down the plate column)</span></em></p>
<div id="barcode_to_name.sh" class="section level4">
<h4><code>Barcode_to_Name.sh</code></h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co"># use this script to remove the barcode from bamfile and replace with sample/indiv name</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="va">pop=$1</span> <span class="co"># this is the metadata file with well number, old label, new label, description, etc (can include header)</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="va">n=</span>$ <span class="kw">(</span><span class="fu">wc</span> -l <span class="va">${pop}</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="va">x=</span>2 <span class="co"># change to 1 if no header</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">## another option for 3 lines above:</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#x=1</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#while [ $x -le 96 ] #This can be adjusted based on number of files</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="kw">while</span><span class="bu"> [</span> <span class="va">$x</span> <span class="ot">-le</span> <span class="va">${n}</span><span class="bu"> ]</span> </a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">do</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"></a>
<a class="sourceLine" id="cb6-16" data-line-number="16">        <span class="va">string=</span><span class="st">&quot;sed -n </span><span class="va">${x}</span><span class="st">p file&quot;</span> <span class="co"># represents whatever metadata file contains columns of barcodes/names</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">        <span class="va">str=$($string)</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">        <span class="va">var=$(</span><span class="bu">echo</span> <span class="va">$str</span> <span class="kw">|</span> <span class="fu">awk</span> -F<span class="st">&quot;\t&quot;</span> <span class="st">&#39;{print $1, $2, $3, $4, $5}&#39;</span><span class="va">)</span>   </a>
<a class="sourceLine" id="cb6-20" data-line-number="20">        <span class="kw">set</span> <span class="ex">--</span> <span class="va">$var</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">        <span class="va">c1=$1</span> <span class="co">## Well Number</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22">        <span class="va">c2=$2</span> <span class="co">## Old Labels</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23">        <span class="va">c3=$3</span> <span class="co">## New Labels</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">        <span class="va">c4=$4</span> <span class="co">## Description</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25">        <span class="va">c5=$5</span> <span class="co">## Barcode</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26">        </a>
<a class="sourceLine" id="cb6-27" data-line-number="27">        <span class="co"># need to fix these two lines to match your specific fastq file name and metadata cols</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28">        <span class="fu">mv</span> SOMM065_RA_GG<span class="va">${c5}</span>TGCAGG.fastq <span class="va">${c3}</span>_RA.fastq</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">        <span class="fu">mv</span> SOMM065_RB_GG<span class="va">${c5}</span>TGCAGG.fastq <span class="va">${c3}</span>_RB.fastq</a>
<a class="sourceLine" id="cb6-30" data-line-number="30"></a>
<a class="sourceLine" id="cb6-31" data-line-number="31">        <span class="va">x=$((</span> <span class="va">$x</span> + 1 <span class="va">))</span> <span class="co"># loop to next line</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="kw">done</span></a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Replace barcode with name of Indiv using Metadata file and script <code>Barcode_to_Name.sh</code>
<ul>
<li><code>sbatch -t 2880 -p high Barcode_to_Name metadatafile</code> 2880 is the number of minutes</li>
</ul></li>
<li>Concatenate each individual’s files into one RA, RB per indiv (if multiple).
<ul>
<li><code>sbatch -t 2880 -p high Concatenate.sh</code> You might need to hardcode the metadata file into this script.</li>
</ul></li>
<li>Keep concatenated files, remove all others. They should be something like <code>NAME1_RA.fastq</code> and <code>NAME1_RB.fastq</code></li>
</ol>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
